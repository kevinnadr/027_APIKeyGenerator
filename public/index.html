<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Hub | Generate API Key</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- GLOBAL VARIABLES --- */
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --border-color: rgba(255, 255, 255, 0.1);
            --primary-color: #6366f1; /* Indigo */
            --primary-hover: #4f46e5;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --error: #ef4444;
            --success: #10b981;
        }

        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            /* Background Gradient Mesh */
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- CARD CONTAINER --- */
        .container {
            width: 100%;
            max-width: 500px;
            padding: 2rem;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- TYPOGRAPHY --- */
        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p.subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        /* --- FORMS --- */
        .form-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .input-wrapper {
            position: relative;
        }

        .form-control {
            width: 100%;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--border-color);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            background: rgba(15, 23, 42, 0.8);
        }

        /* Khusus input API Key agar monospace */
        #apiKeyInput {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            padding-right: 80px; /* Space for copy button */
            color: #818cf8;
            font-weight: 600;
        }

        /* --- BUTTONS --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.875rem;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            margin-top: 1rem;
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Tombol Copy Kecil absolute */
        .copy-btn-absolute {
            position: absolute;
            right: 6px;
            top: 6px;
            bottom: 6px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-muted);
            border-radius: 8px;
            padding: 0 12px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .copy-btn-absolute:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* --- FEEDBACK & FOOTER --- */
        .feedback {
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
            margin-top: 1.5rem;
            min-height: 1.5em;
            padding: 0.5rem;
            border-radius: 8px;
        }
        .feedback.error { background: rgba(239, 68, 68, 0.1); color: var(--error); }
        .feedback.success { background: rgba(16, 185, 129, 0.1); color: var(--success); }

        footer {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.3);
        }

        /* Divider halus */
        .divider {
            height: 1px;
            background: var(--border-color);
            margin: 2rem 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="card">
            <h1>Create API Access</h1>
            <p class="subtitle">Generate kunci API aman Anda dan daftarkan akun untuk memulai integrasi.</p>
    
            <div class="form-group">
                <label for="apiKeyInput">API Key (Generate first)</label>
                <div class="input-wrapper">
                    <input type="text" id="apiKeyInput" class="form-control" value="" readonly placeholder="Klik generate di bawah...">
                    <button id="copyBtn" class="copy-btn-absolute">COPY</button>
                </div>
                <button id="generateBtn" class="btn btn-secondary">Generate New Key</button>
            </div>
    
            <div class="divider"></div>

            <div class="form-group">
                <label for="firstNameInput">First Name</label>
                <input type="text" id="firstNameInput" class="form-control" placeholder="Nama depan Anda">
            </div>

            <div class="form-group">
                <label for="lastNameInput">Last Name <span style="font-weight:400; color: #64748b;">(Optional)</span></label>
                <input type="text" id="lastNameInput" class="form-control" placeholder="Nama belakang Anda">
            </div>
    
            <div class="form-group">
                <label for="emailInput">Email Address</label>
                <input type="email" id="emailInput" class="form-control" placeholder="nama@email.com">
            </div>
            
            <button id="saveBtn" class="btn btn-primary" style="margin-top: 1rem;">Create Account</button>
    
            <div id="saveFeedback" class="feedback"></div>
        </div>

        <footer>
            &copy; 2024 Kevinnadr System. All rights reserved.
        </footer>
    </div>

    <script>
        // --- LOGIC SAMA PERSIS (Copy Paste dari script Anda) ---
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const saveBtn = document.getElementById('saveBtn');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const firstNameInput = document.getElementById('firstNameInput');
        const lastNameInput = document.getElementById('lastNameInput');
        const emailInput = document.getElementById('emailInput');
        const saveFeedback = document.getElementById('saveFeedback');

        async function generateApiKey() {
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            apiKeyInput.value = '...';
            
            try {
                const response = await fetch('/generate-key', { method: 'POST' });
                const data = await response.json();
                if (data.apiKey) {
                    apiKeyInput.value = data.apiKey;
                    apiKeyInput.style.color = '#818cf8'; // Reset warna sukses
                } else throw new Error('No key data');
            } catch (error) {
                console.error(error);
                apiKeyInput.value = 'Error generating key';
                apiKeyInput.style.color = '#ef4444';
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate New Key';
            }
        }

        function copyToClipboard() {
            if (!apiKeyInput.value || apiKeyInput.value.includes('Error') || apiKeyInput.value.includes('...')) return;
            navigator.clipboard.writeText(apiKeyInput.value);
            
            // Efek visual tombol copy
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'COPIED!';
            copyBtn.style.color = '#10b981';
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.style.color = '';
            }, 2000);
        }

        async function saveUser() {
            const apiKey = apiKeyInput.value;
            const firstName = firstNameInput.value;
            const lastName = lastNameInput.value;
            const email = emailInput.value;

            if (!apiKey || !firstName || !email || apiKey.includes('...')) {
                showFeedback('Please fill in Name, Email & Generate Key.', 'error');
                return;
            }

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';
            saveFeedback.textContent = '';
            saveFeedback.className = 'feedback';

            try {
                const response = await fetch('/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, firstName, lastName, email })
                });
                const data = await response.json();

                if (response.ok) {
                    showFeedback('Success! Account & Key Registered.', 'success');
                    // Reset inputs
                    apiKeyInput.value = '';
                    firstNameInput.value = '';
                    lastNameInput.value = '';
                    emailInput.value = '';
                } else {
                    throw new Error(data.error || 'Failed to save');
                }
            } catch (error) {
                showFeedback(error.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Create Account';
            }
        }

        function showFeedback(msg, type) {
            saveFeedback.textContent = msg;
            saveFeedback.className = `feedback ${type}`;
        }

        generateBtn.addEventListener('click', generateApiKey);
        copyBtn.addEventListener('click', copyToClipboard);
        saveBtn.addEventListener('click', saveUser);
    </script>
</body>
</html>